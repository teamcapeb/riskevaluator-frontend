<div class="dashboard">
  <div class="dashboard-sidebar">
    <mat-card class="sidebar-card">
      <div class="dashboard-title">
        <h2><b>Dashboard RiskEvaluator</b></h2>
      </div>
      <div class="filtres">
        <div class="entreprise-filtre">
          <mat-form-field style="width: 220px;" appearance="fill">
            <mat-label>Entreprises</mat-label>
            <mat-select [formControl]="entrepriseControl" multiple>
              <mat-select-trigger>
                {{entrepriseControl.value?.[0] || ''}}
                <span *ngIf="(entrepriseControl.value?.length || 0) > 1" class="example-additional-selection">
                  (+{{(entrepriseControl.value?.length || 0) - 1}} {{entrepriseControl.value?.length === 2 ? 'autre' : 'autres'}})
                </span>
              </mat-select-trigger>
              <mat-option #matOption *ngFor="let entreprise of allEntreprises" [value]="entreprise.nomEntreprise"
                (click)="selectEntreprise(entreprise, matOption.selected)">
                {{ entreprise?.nomEntreprise }}
                <span style="font-size: 11px;">
                  {{ " (SIRET: " + (entreprise?.noSiret) + ")" }}
                </span>
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="questionnaire-filtre">
          <mat-form-field style="width: 220px;" appearance="fill">
            <mat-label>Questionnaires</mat-label>
            <mat-select [formControl]="questionnaireControl" multiple>
              <mat-select-trigger>
                {{questionnaireControl.value?.[0] || ''}}
                <span *ngIf="(questionnaireControl.value?.length || 0) > 1" class="example-additional-selection">
                  (+{{(questionnaireControl.value?.length || 0) - 1}} {{questionnaireControl.value?.length === 2 ? 'autre' : 'autres'}})
                </span>
              </mat-select-trigger>
              <mat-option *ngFor="let questionnaire of allQuestionnaires" [value]="questionnaire.thematique">{{questionnaire?.thematique}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="metier-filtre">
          <mat-form-field style="width: 220px;" appearance="fill">
            <mat-label>Métiers</mat-label>
            <mat-select [formControl]="metierControl" multiple>
              <mat-select-trigger>
                {{metierControl.value?.[0] || ''}}
                <span *ngIf="(metierControl.value?.length || 0) > 1" class="example-additional-selection">
                  (+{{(metierControl.value?.length || 0) - 1}} {{metierControl.value?.length === 2 ? 'autre' : 'autres'}})
                </span>
              </mat-select-trigger>
              <mat-option #matOption *ngFor="let metier of allMetiers" [value]="metier.nomMetier"
                (click)="selectMetier(metier, matOption.selected)">{{metier?.nomMetier}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div>
          <mat-form-field appearance="fill">
            <mat-label>Plage de dates</mat-label>
            <mat-date-range-input [formGroup]="range" [rangePicker]="picker">
              <input matStartDate formControlName="start" placeholder="Start date">
              <input matEndDate formControlName="end" placeholder="End date">
            </mat-date-range-input>
            <mat-hint>MM/DD/YYYY – MM/DD/YYYY</mat-hint>
            <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-date-range-picker #picker></mat-date-range-picker>
          </mat-form-field>
        </div>
      </div>
    </mat-card>
  </div>
  <div class="dashboard-content">
    <div class="dashboard-header">
      <mat-card class="header-card">
        <mat-card class="numeric-card">
          <p>Nombre d'entreprises</p>
          <p class="number">{{ filteredEntreprises.length }}</p>
        </mat-card>
        <mat-card class="numeric-card">
          <p>Nombre de métiers</p>
          <p class="number">{{ filteredMetiers.length }}</p>
        </mat-card>
        <mat-card class="numeric-card">
          <p>Nombre d'évaluations</p>
          <p  class="number">{{ filteredEvaluations.length }}</p>
        </mat-card>
      </mat-card>
    </div>
    <div class="dashboard-graphs">
      <div class="graphs">
        <mat-card class="graphs-card">
          <div class="graph-div" *ngIf="!hide1 || !hide2">
            <mat-card *ngIf="!hide1" class="graph-card" (click)="expand1()">
              <tui-root>
                <tui-axes
                  class="axes"
                  [axisXLabels]="graph1LabelsX"
                  [axisYLabels]="graph1LabelsY"
                >
                  <tui-bar-chart
                    [max]="100"
                    [value]="value"
                    [tuiHintAppearance]="appearance"
                    [tuiHintContent]="hint"
                  ></tui-bar-chart>
                </tui-axes>
              </tui-root>
            </mat-card>
            <mat-card  *ngIf="!hide2" class="graph-card" (click)="expand2()">
             P {{ petitesEntreprises.length }} -- M {{ moyennesEntreprises.length }} -- G {{ grandesEntreprises.length }}
            </mat-card>
          </div>
          <div class="graph-div" *ngIf="!hide3 || !hide4">
            <mat-card *ngIf="!hide3" class="graph-card" (click)="expand3()">
              <tui-root>
                <tui-axes *ngIf="scoresMetiers.length > 0"
                          class="axes"
                          [axisXLabels]="metierNames"
                          [axisYLabels]="graph1LabelsY">
                  <tui-bar-chart
                    [max]="100"
                    [value]="scoresMetiers"
                    [tuiHintAppearance]="appearance"
                    [tuiHintContent]="hint2"></tui-bar-chart>
                </tui-axes>
              </tui-root>
            </mat-card>
            <mat-card *ngIf="!hide4" class="graph-card" (click)="expand4()">
              b
            </mat-card>
          </div>
        </mat-card>
      </div>
    </div>
  </div>
</div>
